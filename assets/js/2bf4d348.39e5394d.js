"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[32552],{79478:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>d,toc:()=>o});var s=r(85893),t=r(11151);const i={title:"Tag 5",tags:["M141","Tag 5","Datenbanksysteme","Import","Export","Backup","Restore","Migration"]},a="Tag 5",d={id:"M141/tag-0005",title:"Tag 5",description:"1 Dokumentationsauftr\xe4ge",source:"@site/docs/M141/tag-0005.md",sourceDirName:"M141",slug:"/M141/tag-0005",permalink:"/docs/M141/tag-0005",draft:!1,unlisted:!1,tags:[{label:"M141",permalink:"/docs/tags/m-141"},{label:"Tag 5",permalink:"/docs/tags/tag-5"},{label:"Datenbanksysteme",permalink:"/docs/tags/datenbanksysteme"},{label:"Import",permalink:"/docs/tags/import"},{label:"Export",permalink:"/docs/tags/export"},{label:"Backup",permalink:"/docs/tags/backup"},{label:"Restore",permalink:"/docs/tags/restore"},{label:"Migration",permalink:"/docs/tags/migration"}],version:"current",frontMatter:{title:"Tag 5",tags:["M141","Tag 5","Datenbanksysteme","Import","Export","Backup","Restore","Migration"]},sidebar:"tutorialSidebar",previous:{title:"Tag 4",permalink:"/docs/M141/tag-0004"},next:{title:"Tag 6",permalink:"/docs/M141/tag-0006"}},l={},o=[{value:"1 Dokumentationsauftr\xe4ge",id:"1-dokumentationsauftr\xe4ge",level:2},{value:"1.1 Datentypen recherchiert",id:"11-datentypen-recherchiert",level:3},{value:"1.2 Indexierungstypen recherchiert",id:"12-indexierungstypen-recherchiert",level:3},{value:"2 \xdcbungen",id:"2-\xfcbungen",level:2},{value:"2.1 SQL Import",id:"21-sql-import",level:3},{value:"2.2 CSV Export (Select)",id:"22-csv-export-select",level:3},{value:"2.3 Lokales Backup",id:"23-lokales-backup",level:3},{value:"2.4 mydumper und myloader",id:"24-mydumper-und-myloader",level:3},{value:"2.5 Migration auf entfernten Server",id:"25-migration-auf-entfernten-server",level:3}];function c(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"tag-5",children:"Tag 5"}),"\n",(0,s.jsx)(n.h2,{id:"1-dokumentationsauftr\xe4ge",children:"1 Dokumentationsauftr\xe4ge"}),"\n",(0,s.jsx)(n.h3,{id:"11-datentypen-recherchiert",children:"1.1 Datentypen recherchiert"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"/docs/M141/tag-0004#213-datentypen--attribute",children:"Tag 4 - Kapitel 2.1.3"})}),"\n",(0,s.jsx)(n.h3,{id:"12-indexierungstypen-recherchiert",children:"1.2 Indexierungstypen recherchiert"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"/docs/M141/tag-0004#214-indexierung",children:"Tag 4 - Kapitel 2.1.4"})}),"\n",(0,s.jsx)(n.h2,{id:"2-\xfcbungen",children:"2 \xdcbungen"}),"\n",(0,s.jsx)(n.h3,{id:"21-sql-import",children:"2.1 SQL Import"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Importieren Sie den SQL-Dump in Ihr DBMS"})}),"\n",(0,s.jsx)(n.p,{children:"Datenbank erstellen:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE DATABASE poke_db;\n"})}),"\n",(0,s.jsx)(n.p,{children:"Import durchf\xfchren (ausserhalb MySQL Server):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"sudo mysql -u root -p poke_db < poke_db.sql\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Kontrollieren Sie ob der Import erfolgreich war"})}),"\n",(0,s.jsx)(n.p,{children:"Sind die Tabellen erstellt?"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"USE poke_db;\nSHOW TABLES;\n"})}),"\n",(0,s.jsx)(n.p,{children:"Datenstruktur von einer Tabelle \xfcberpr\xfcfen:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"DESCRIBE abilities;\n"})}),"\n",(0,s.jsx)(n.p,{children:"Daten in Tabelle \xfcberp\xfcfen:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM pokemon LIMIT 5;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"22-csv-export-select",children:"2.2 CSV Export (Select)"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:'Exportieren Sie eine CSV-Datei aus allen Pokemons, die einen "fire-punch" als Move durchf\xfchren k\xf6nnen'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT p.pok_name\nFROM pokemon p\nJOIN pokemon_moves pm ON p.pok_id=pm.pok_id\nJOIN moves m ON pm.move_id=m.move_id\nWHERE m.move_name\nLIKE \"fire-punch\"\nINTO OUTFILE '/var/lib/mysql-files/poke_fire-punch.csv'\nFIELDS ENCLOSED BY '\"'\nTERMINATED BY ';'\nLINES TERMINATED BY '\\n';\n"})}),"\n",(0,s.jsx)(n.h3,{id:"23-lokales-backup",children:"2.3 Lokales Backup"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:'Richten Sie auf Ihrem Server ein Backup-Script, gem\xe4ss der Vorlage, ein. Testen Sie das Script aus ob der Export funktioniert und Sie die Daten auch wieder importieren k\xf6nnen ("Niemand will Backup - alle wollen restore")'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Add the backup dir location, MySQL root password, MySQL and mysqldump location\nDATE=$(date +%d-%m-%Y)\nBACKUP_DIR="/tmp/test-backup"\nMYSQL_USER=\'root\'\nMYSQL_PASSWORD=\'MySQL_M141#\'\nMYSQL=/usr/bin/mysql\nMYSQLDUMP=/usr/bin/mysqldump\n\n# To create a new directory in the backup directory location based on the date\nmkdir -p $BACKUP_DIR/$DATE\n\n# To get a list of databases\ndatabases=`$MYSQL -u$MYSQL_USER -p$MYSQL_PASSWORD -e "SHOW DATABASES;" | grep -Ev "(Database|information_schema)"`\n\n# To dump each database in a separate file\nfor db in $databases; do\necho $db\n$MYSQLDUMP --single-transaction --force --opt --skip-lock-tables --user=$MYSQL_USER -p$MYSQL_PASSWORD --databases $db | gzip > "$BACKUP_DIR/$DATE/$db.sql.gz"\ndone\n\n# Delete the files older than 10 days\nfind $BACKUP_DIR/* -mtime +10 -exec rm {} \\;\n'})}),"\n",(0,s.jsx)(n.p,{children:"Import testen (Datebank zerst\xf6ren (z.B. l\xf6schen)):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"cp /tmp/test-backup/DATE/demo_db.sql.gz ~\ngzip -d demo_db.sql.gz\nsudo mysql -u root -p < demo_db.sql\n"})}),"\n",(0,s.jsx)(n.h3,{id:"24-mydumper-und-myloader",children:"2.4 mydumper und myloader"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"mydumper"})," und ",(0,s.jsx)(n.code,{children:"myloader"})," installieren:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"wget https://github.com/mydumper/mydumper/releases/download/v0.12.1/mydumper_0.12.1-1-zstd.focal_amd64.deb\nsudo dpkg -i mydumper_0.12.1-1-zstd.focal_amd64.deb\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"F\xfchren Sie mittels mydumper ein DB-Backup von Ihrem Pokemon-Datenbank durch. Achtung:"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"- Benutzen Sie f\xfcr das Backup 6 parallele Threads"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"- Komprimieren Sie das Backup"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo mydumper --database poke_db -c --threads 6\nsudo chown -R vagrant:vagrant EXPORT-FOLDER\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"L\xf6schen Sie die orginale DB"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"DROP DATABASE poke_db;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Restoren Sie die DB aus Ihrem Backup"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo myloader -d EXPORT-FOLDER --threads 6 -v 3\n"})}),"\n",(0,s.jsx)(n.h3,{id:"25-migration-auf-entfernten-server",children:"2.5 Migration auf entfernten Server"}),"\n",(0,s.jsx)(n.admonition,{title:"Vorbereitung",type:"note",children:(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Erstellen Sie einen Klon Ihrer MySQL-VM mit neuen MAC-Adressen"}),"\n",(0,s.jsx)(n.li,{children:"Verbinden Sie die orginale VM mit der geklonten VM in einem NAT-Network <- Testen Sie die Verbindung untereinander"}),"\n",(0,s.jsx)(n.li,{children:"Testen Sie die SSH-Verbindung zwischen den VMs"}),"\n"]})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:'F\xfchren Sie einen entfernten Backup mittels SSH, gem\xe4ss den Anleitung von oben, durch. Nutzen Sie das Beispiel "Verbindung zwischen den Servern per SSH m\xf6glich".'})}),"\n",(0,s.jsx)(n.admonition,{title:"Schrittweises Vorgehen:",type:"note",children:(0,s.jsx)(n.p,{children:"SSH auf den Export-Server Dump durchf\xfchren und Ausabe auf PIPE umleiten die PIPE umleiten auf die SSH-Verbindung zum Import-Server"})}),"\n",(0,s.jsx)(n.p,{children:"Auf Export-Server:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo mysqldump --single-transaction -u root -pMySQL_M141# poke_db | ssh vagrant@10.0.2.15 'sudo mysql -u root -pMySQL_M141# -e \"CREATE DATABASE poke_db\"; sudo mysql -u root -pMySQL_M141# poke_db'\n"})})]})}function p(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>d,a:()=>a});var s=r(67294);const t={},i=s.createContext(t);function a(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);