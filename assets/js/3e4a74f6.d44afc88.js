"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[8344],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>N});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var o=r.createContext({}),d=function(e){var n=r.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=d(e.components);return r.createElement(o.Provider,{value:n},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},c=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,l=e.originalType,o=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=d(t),c=a,N=p["".concat(o,".").concat(c)]||p[c]||m[c]||l;return t?r.createElement(N,i(i({ref:n},u),{},{components:t})):r.createElement(N,i({ref:n},u))}));function N(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var l=t.length,i=new Array(l);i[0]=c;var s={};for(var o in n)hasOwnProperty.call(n,o)&&(s[o]=n[o]);s.originalType=e,s[p]="string"==typeof e?e:a,i[1]=s;for(var d=2;d<l;d++)i[d]=t[d];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}c.displayName="MDXCreateElement"},56449:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>s,toc:()=>d});var r=t(87462),a=(t(67294),t(3905));const l={title:"Tag 9",tags:["M141","Tag 9","Datenbanksysteme","Performance","Indexing"]},i="Tag 9",s={unversionedId:"M141/tag-0009",id:"M141/tag-0009",title:"Tag 9",description:"1 Dokumentationsauftr\xe4ge",source:"@site/docs/M141/tag-0009.md",sourceDirName:"M141",slug:"/M141/tag-0009",permalink:"/docs/M141/tag-0009",draft:!1,tags:[{label:"M141",permalink:"/docs/tags/m-141"},{label:"Tag 9",permalink:"/docs/tags/tag-9"},{label:"Datenbanksysteme",permalink:"/docs/tags/datenbanksysteme"},{label:"Performance",permalink:"/docs/tags/performance"},{label:"Indexing",permalink:"/docs/tags/indexing"}],version:"current",frontMatter:{title:"Tag 9",tags:["M141","Tag 9","Datenbanksysteme","Performance","Indexing"]},sidebar:"tutorialSidebar",previous:{title:"Tag 8",permalink:"/docs/M141/tag-0008"},next:{title:"M143",permalink:"/docs/M143/"}},o={},d=[{value:"1 Dokumentationsauftr\xe4ge",id:"1-dokumentationsauftr\xe4ge",level:2},{value:"1.1 Kurzzusammenfassung zu den Performance Tips",id:"11-kurzzusammenfassung-zu-den-performance-tips",level:3},{value:"1.1.1 Attribute indexieren",id:"111-attribute-indexieren",level:4},{value:"1.1.1.1 Problem",id:"1111-problem",level:5},{value:"1.1.1.2 L\xf6sung",id:"1112-l\xf6sung",level:5},{value:"1.1.2 <code>UNIONS</code> verwenden",id:"112-unions-verwenden",level:4},{value:"1.1.2.1 Problem",id:"1121-problem",level:5},{value:"1.1.2.2 L\xf6sung",id:"1122-l\xf6sung",level:5},{value:"1.1.3 Wildcards",id:"113-wildcards",level:4},{value:"1.1.3.1 Problem",id:"1131-problem",level:5},{value:"1.1.3.2 L\xf6sung",id:"1132-l\xf6sung",level:5},{value:"1.1.4 Full-Text-Searches nutzen",id:"114-full-text-searches-nutzen",level:4},{value:"1.1.4.1 Problem",id:"1141-problem",level:5},{value:"1.1.4.2 L\xf6sung",id:"1142-l\xf6sung",level:5},{value:"1.1.5 Datenbank-Design",id:"115-datenbank-design",level:4},{value:"1.2 \xdcbungsdokumentation zu Performance und Indexing",id:"12-\xfcbungsdokumentation-zu-performance-und-indexing",level:3}],u={toc:d},p="wrapper";function m(e){let{components:n,...t}=e;return(0,a.kt)(p,(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"tag-9"},"Tag 9"),(0,a.kt)("h2",{id:"1-dokumentationsauftr\xe4ge"},"1 Dokumentationsauftr\xe4ge"),(0,a.kt)("h3",{id:"11-kurzzusammenfassung-zu-den-performance-tips"},"1.1 Kurzzusammenfassung zu den Performance Tips"),(0,a.kt)("h4",{id:"111-attribute-indexieren"},"1.1.1 Attribute indexieren"),(0,a.kt)("p",null,"Alle Attribute die bei ",(0,a.kt)("inlineCode",{parentName:"p"},"WHERE"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"ORDER BY")," und ",(0,a.kt)("inlineCode",{parentName:"p"},"GROUP BY")," genutzt werden, sollten indexiert sein.",(0,a.kt)("br",{parentName:"p"}),"\n",(0,a.kt)("a",{parentName:"p",href:"/docs/M141/tag-0004#214-indexierung"},"-> Tag 4 - Kapitel 2.1.4")),(0,a.kt)("h5",{id:"1111-problem"},"1.1.1.1 Problem"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"select customer_id, customer_name from customers where customer_id='140385';\n")),(0,a.kt)("p",null,"Wird dieses Statement auf einer Datenbank mit 500 Datens\xe4tzen ausgef\xfchrt, werden alle Werte \xfcberpr\xfcft."),(0,a.kt)("p",null,"Mit einem ",(0,a.kt)("inlineCode",{parentName:"p"},"EXPLAIN")," kann man \xfcberpr\xfcfen, was bei der Abfrage passiert."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"explain select customer_id, customer_name from customers where customer_id='140385';\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="OUTPUT"',title:'"OUTPUT"'},"+----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+\n| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |\n+----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+\n|  1 | SIMPLE      | customers | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  500 |    10.00 | Using where |\n+----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"key"),": Ist der ",(0,a.kt)("inlineCode",{parentName:"p"},"key")," auf ",(0,a.kt)("inlineCode",{parentName:"p"},"NULL"),", ist das immer schlecht da er keinen key zum suchen nutzt.",(0,a.kt)("br",{parentName:"p"}),"\n",(0,a.kt)("inlineCode",{parentName:"p"},"rows"),": Dieses Attribut zeigt wie viele Datens\xe4tze gesucht werden."),(0,a.kt)("h5",{id:"1112-l\xf6sung"},"1.1.1.2 L\xf6sung"),(0,a.kt)("p",null,"Index erstellen"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"Create index customer_id ON customers (customer_Id);\n")),(0,a.kt)("p",null,"Abfrage per ",(0,a.kt)("inlineCode",{parentName:"p"},"EXPLAIN")," \xfcberpr\xfcfen"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"Explain select customer_id, customer_name from customers where customer_id='140385';\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="OUTPUT"',title:'"OUTPUT"'},"+----+-------------+-----------+------------+------+---------------+-------------+---------+-------+------+----------+-------+\n| id | select_type | table     | partitions | type | possible_keys | key         | key_len | ref   | rows | filtered | Extra |\n+----+-------------+-----------+------------+------+---------------+-------------+---------+-------+------+----------+-------+\n|  1 | SIMPLE      | customers | NULL       | ref  | customer_id   | customer_id | 13      | const |    1 |   100.00 | NULL  |\n+----+-------------+-----------+------------+------+---------------+-------------+---------+-------+------+----------+-------+\n")),(0,a.kt)("p",null,"Da jetzt ein ",(0,a.kt)("inlineCode",{parentName:"p"},"key")," existiert und dieser genutzt wird, wird nicht mehr ",(0,a.kt)("inlineCode",{parentName:"p"},"NULL")," angezeigt. Auch kann man sehen, dass bei ",(0,a.kt)("inlineCode",{parentName:"p"},"rows")," nur noch ein Datensatz gesucht wird, da er nach der ",(0,a.kt)("inlineCode",{parentName:"p"},"customer_id")," suchen kann."),(0,a.kt)("h4",{id:"112-unions-verwenden"},"1.1.2 ",(0,a.kt)("inlineCode",{parentName:"h4"},"UNIONS")," verwenden"),(0,a.kt)("p",null,"Wenn bei einem ",(0,a.kt)("inlineCode",{parentName:"p"},"WHERE"),"-Statement mit ",(0,a.kt)("inlineCode",{parentName:"p"},"OR")," gearbeitet werden muss, sollte ein ",(0,a.kt)("inlineCode",{parentName:"p"},"UNION")," genutzt werden. Dieser kombiniert die Resultate von mehreren ",(0,a.kt)("inlineCode",{parentName:"p"},"SELECTS"),"."),(0,a.kt)("h5",{id:"1121-problem"},"1.1.2.1 Problem"),(0,a.kt)("p",null,"Wenn Abfragen mit ",(0,a.kt)("inlineCode",{parentName:"p"},"OR")," durchgef\xfchrt werden, wird immer ein Full-Table-Scan gemacht, auch wenn man einen Index nutzt. Mit ",(0,a.kt)("inlineCode",{parentName:"p"},"UNION")," kann dieses Problem gel\xf6st werden."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"select * from students where first_name like 'Ade%'  or last_name like 'Ade%' ;\n")),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"p"},"first_name")," und ",(0,a.kt)("inlineCode",{parentName:"p"},"last_name")," sind indexiert.")),(0,a.kt)("h5",{id:"1122-l\xf6sung"},"1.1.2.2 L\xf6sung"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"select * from students where first_name like 'Ade%' union all\nselect * from students where last_name like 'Ade%' ;\n")),(0,a.kt)("h4",{id:"113-wildcards"},"1.1.3 Wildcards"),(0,a.kt)("p",null,"Wildcards (",(0,a.kt)("inlineCode",{parentName:"p"},"*"),") sollten vermeidet werden... ganz einfach."),(0,a.kt)("h5",{id:"1131-problem"},"1.1.3.1 Problem"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"select * from students where first_name like '%Ade' ;\n")),(0,a.kt)("h5",{id:"1132-l\xf6sung"},"1.1.3.2 L\xf6sung"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"select last_name from students where first_name like '%Ade' ;\n")),(0,a.kt)("h4",{id:"114-full-text-searches-nutzen"},"1.1.4 Full-Text-Searches nutzen"),(0,a.kt)("p",null,"Full-Text-Searches ist besser als Wildcard"),(0,a.kt)("h5",{id:"1141-problem"},"1.1.4.1 Problem"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"select * from students where first_name like  '%Ade' ;\n")),(0,a.kt)("h5",{id:"1142-l\xf6sung"},"1.1.4.2 L\xf6sung"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"Alter table students ADD FULLTEXT (first_name, last_name);\nSelect * from students where match(first_name, last_name) AGAINST ('Ade');\nexplain Select * from students where match(first_name, last_name) AGAINST ('Ade');\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="OUTPUT"',title:'"OUTPUT"'},"+----+-------------+----------+------------+----------+---------------+------------+---------+-------+------+----------+-------------------------------+\n| id | select_type | table    | partitions | type     | possible_keys | key        | key_len | ref   | rows | filtered | Extra                         |\n+----+-------------+----------+------------+----------+---------------+------------+---------+-------+------+----------+-------------------------------+\n|  1 | SIMPLE      | students | NULL       | fulltext | first_name    | first_name | 0       | const |    1 |   100.00 | Using where; Ft_hints: sorted |\n+----+-------------+----------+------------+----------+---------------+------------+---------+-------+------+----------+-------------------------------+\n")),(0,a.kt)("p",null,"Der ",(0,a.kt)("inlineCode",{parentName:"p"},"SELECT")," sucht jetzt in ",(0,a.kt)("inlineCode",{parentName:"p"},"first_name")," und ",(0,a.kt)("inlineCode",{parentName:"p"},"last_name")," nach dem Suchbegriff ",(0,a.kt)("inlineCode",{parentName:"p"},"Ade"),". Dies kann auch im ",(0,a.kt)("inlineCode",{parentName:"p"},"EXPLAIN")," unter ",(0,a.kt)("inlineCode",{parentName:"p"},"type")," gesehen werden."),(0,a.kt)("h4",{id:"115-datenbank-design"},"1.1.5 Datenbank-Design"),(0,a.kt)("p",null,"Grunds\xe4tzlich gilt:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Redunante Daten vermeiden"),(0,a.kt)("li",{parentName:"ul"},"Korrekte ",(0,a.kt)("a",{parentName:"li",href:"/docs/M141/tag-0004#213-datentypen--attribute"},"Datentypen")," verwenden"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"NULL"),"-Werte vermeiden (",(0,a.kt)("inlineCode",{parentName:"li"},"EXPLAIN")," hilft hier)"),(0,a.kt)("li",{parentName:"ul"},"Viele Spalten in einer Tabellen vermeiden"),(0,a.kt)("li",{parentName:"ul"},'SQL-Joins "klein" halten. Nur die notwendigen Tabellen einbeziehen.'),(0,a.kt)("li",{parentName:"ul"},"Keine Wildcards")),(0,a.kt)("h3",{id:"12-\xfcbungsdokumentation-zu-performance-und-indexing"},"1.2 \xdcbungsdokumentation zu Performance und Indexing"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"DB installieren (",(0,a.kt)("a",{parentName:"p",href:"/appendix/M141/classicModelsOhneIndex"},"Skript"),")")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Es existieren noch keine Indexe auf der Datenbank. Mit ",(0,a.kt)("inlineCode",{parentName:"p"},"EXPLAIN")," kann das \xfcberpr\xfcft werden."))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},'EXPLAIN SELECT * FROM orderdetails d\n    INNER JOIN orders o ON d.orderNumber = o.orderNumber\n    INNER JOIN products p ON p.productCode = d.productCode\n    INNER JOIN productlines l ON p.productLine = l.productLine\n    INNER JOIN customers c on c.customerNumber = o.customerNumber\nWHERE o.orderNumber = "10101";\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="OUTPUT"',title:'"OUTPUT"'},"+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+--------------------------------------------+\n| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                                      |\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+--------------------------------------------+\n|  1 | SIMPLE      | l     | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    7 |   100.00 | NULL                                       |\n|  1 | SIMPLE      | p     | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  110 |    10.00 | Using where; Using join buffer (hash join) |\n|  1 | SIMPLE      | o     | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  326 |    10.00 | Using where; Using join buffer (hash join) |\n|  1 | SIMPLE      | c     | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  122 |    10.00 | Using where; Using join buffer (hash join) |\n|  1 | SIMPLE      | d     | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 2996 |     1.00 | Using where; Using join buffer (hash join) |\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+--------------------------------------------+\n5 rows in set, 1 warning (0.04 sec)\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"type"),": steht auf ",(0,a.kt)("inlineCode",{parentName:"p"},"ALL"),", somit wird die ganze Tabelle durchsucht (also kein Index oder Fulltext)",(0,a.kt)("br",{parentName:"p"}),"\n",(0,a.kt)("inlineCode",{parentName:"p"},"keys")," und ",(0,a.kt)("inlineCode",{parentName:"p"},"possible_key"),": steht auf ",(0,a.kt)("inlineCode",{parentName:"p"},"NULL"),", da es keine Indexe gibt",(0,a.kt)("br",{parentName:"p"}),"\n",(0,a.kt)("inlineCode",{parentName:"p"},"rows"),": Es werden 7 ","*"," 110 ","*"," 326 ","*"," 122 ","*"," 2'996 = 91'750'822'240 (91 Mrd.) Elemente gesucht"),(0,a.kt)("ol",{start:3},(0,a.kt)("li",{parentName:"ol"},"Primary Key Indexe einf\xfchren")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER TABLE customers ADD PRIMARY KEY (customerNumber);\nALTER TABLE employees ADD PRIMARY KEY (employeeNumber);\nALTER TABLE offices ADD PRIMARY KEY (officeCode);\nALTER TABLE orderdetails ADD PRIMARY KEY (orderNumber, productCode);\nALTER TABLE orders ADD PRIMARY KEY (orderNumber), ADD KEY (customerNumber);\nALTER TABLE payments ADD PRIMARY KEY (customerNumber, checkNumber);\nALTER TABLE productlines ADD PRIMARY KEY (productLine);\nALTER TABLE products ADD PRIMARY KEY (productCode), ADD KEY (buyPrice), ADD KEY (productLine);\nALTER TABLE productvariants ADD PRIMARY KEY (variantId), ADD KEY (buyPrice), ADD KEY (productCode);\n")),(0,a.kt)("ol",{start:4},(0,a.kt)("li",{parentName:"ol"},"Per ",(0,a.kt)("inlineCode",{parentName:"li"},"EXPLAIN")," die Abfrage wieder \xfcberpr\xfcfen")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},'EXPLAIN SELECT * FROM orderdetails d\n    INNER JOIN orders o ON d.orderNumber = o.orderNumber\n    INNER JOIN products p ON p.productCode = d.productCode\n    INNER JOIN productlines l ON p.productLine = l.productLine\n    INNER JOIN customers c on c.customerNumber = o.customerNumber\nWHERE o.orderNumber = "10101";\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="OUTPUT"',title:'"OUTPUT"'},"+----+-------------+-------+------------+--------+------------------------+---------+---------+------------------------------+------+----------+-----------------------+\n| id | select_type | table | partitions | type   | possible_keys          | key     | key_len | ref                          | rows | filtered | Extra                 |\n+----+-------------+-------+------------+--------+------------------------+---------+---------+------------------------------+------+----------+-----------------------+\n|  1 | SIMPLE      | o     | NULL       | const  | PRIMARY,customerNumber | PRIMARY | 4       | const                        |    1 |   100.00 | NULL                  |\n|  1 | SIMPLE      | c     | NULL       | const  | PRIMARY                | PRIMARY | 4       | const                        |    1 |   100.00 | NULL                  |\n|  1 | SIMPLE      | d     | NULL       | ref    | PRIMARY                | PRIMARY | 4       | const                        |    4 |   100.00 | Using index condition |\n|  1 | SIMPLE      | p     | NULL       | eq_ref | PRIMARY,productLine    | PRIMARY | 17      | explaintesting.d.productCode |    1 |   100.00 | NULL                  |\n|  1 | SIMPLE      | l     | NULL       | eq_ref | PRIMARY                | PRIMARY | 52      | explaintesting.p.productLine |    1 |   100.00 | NULL                  |\n+----+-------------+-------+------------+--------+------------------------+---------+---------+------------------------------+------+----------+-----------------------+\n5 rows in set, 1 warning (0.00 sec)\n")),(0,a.kt)("p",null,"Jetzt hat jede Tabelle einen definierten ",(0,a.kt)("inlineCode",{parentName:"p"},"type")," und nutzt immer einen ",(0,a.kt)("inlineCode",{parentName:"p"},"key"),". Die ",(0,a.kt)("inlineCode",{parentName:"p"},"rows")," k\xf6nnen jetzt nochmals nachgerechnet werden. 1 ","*"," 1 ","*"," 4 ","*"," 1 ","*"," 1 = 4. Nat\xfcrlich viel besser."))}m.isMDXComponent=!0}}]);