"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[68344],{98956:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>u,frontMatter:()=>d,metadata:()=>l,toc:()=>a});var r=s(85893),i=s(11151);const d={title:"Tag 9",tags:["M141","Tag 9","Datenbanksysteme","Performance","Indexing"]},t="Tag 9",l={id:"M141/tag-0009",title:"Tag 9",description:"1 Dokumentationsauftr\xe4ge",source:"@site/docs/M141/tag-0009.md",sourceDirName:"M141",slug:"/M141/tag-0009",permalink:"/docs/M141/tag-0009",draft:!1,unlisted:!1,tags:[{label:"M141",permalink:"/docs/tags/m-141"},{label:"Tag 9",permalink:"/docs/tags/tag-9"},{label:"Datenbanksysteme",permalink:"/docs/tags/datenbanksysteme"},{label:"Performance",permalink:"/docs/tags/performance"},{label:"Indexing",permalink:"/docs/tags/indexing"}],version:"current",frontMatter:{title:"Tag 9",tags:["M141","Tag 9","Datenbanksysteme","Performance","Indexing"]},sidebar:"tutorialSidebar",previous:{title:"Tag 8",permalink:"/docs/M141/tag-0008"},next:{title:"Tag 10",permalink:"/docs/M141/tag-0010"}},c={},a=[{value:"1 Dokumentationsauftr\xe4ge",id:"1-dokumentationsauftr\xe4ge",level:2},{value:"1.1 Kurzzusammenfassung zu den Performance Tips",id:"11-kurzzusammenfassung-zu-den-performance-tips",level:3},{value:"1.1.1 Attribute indexieren",id:"111-attribute-indexieren",level:4},{value:"1.1.1.1 Problem",id:"1111-problem",level:5},{value:"1.1.1.2 L\xf6sung",id:"1112-l\xf6sung",level:5},{value:"1.1.2 <code>UNIONS</code> verwenden",id:"112-unions-verwenden",level:4},{value:"1.1.2.1 Problem",id:"1121-problem",level:5},{value:"1.1.2.2 L\xf6sung",id:"1122-l\xf6sung",level:5},{value:"1.1.3 Wildcards",id:"113-wildcards",level:4},{value:"1.1.3.1 Problem",id:"1131-problem",level:5},{value:"1.1.3.2 L\xf6sung",id:"1132-l\xf6sung",level:5},{value:"1.1.4 Full-Text-Searches nutzen",id:"114-full-text-searches-nutzen",level:4},{value:"1.1.4.1 Problem",id:"1141-problem",level:5},{value:"1.1.4.2 L\xf6sung",id:"1142-l\xf6sung",level:5},{value:"1.1.5 Datenbank-Design",id:"115-datenbank-design",level:4},{value:"1.2 \xdcbungsdokumentation zu Performance und Indexing",id:"12-\xfcbungsdokumentation-zu-performance-und-indexing",level:3}];function o(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"tag-9",children:"Tag 9"}),"\n",(0,r.jsx)(n.h2,{id:"1-dokumentationsauftr\xe4ge",children:"1 Dokumentationsauftr\xe4ge"}),"\n",(0,r.jsx)(n.h3,{id:"11-kurzzusammenfassung-zu-den-performance-tips",children:"1.1 Kurzzusammenfassung zu den Performance Tips"}),"\n",(0,r.jsx)(n.h4,{id:"111-attribute-indexieren",children:"1.1.1 Attribute indexieren"}),"\n",(0,r.jsxs)(n.p,{children:["Alle Attribute die bei ",(0,r.jsx)(n.code,{children:"WHERE"}),", ",(0,r.jsx)(n.code,{children:"ORDER BY"})," und ",(0,r.jsx)(n.code,{children:"GROUP BY"})," genutzt werden, sollten indexiert sein.",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.a,{href:"/docs/M141/tag-0004#214-indexierung",children:"-> Tag 4 - Kapitel 2.1.4"})]}),"\n",(0,r.jsx)(n.h5,{id:"1111-problem",children:"1.1.1.1 Problem"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"select customer_id, customer_name from customers where customer_id='140385';\n"})}),"\n",(0,r.jsx)(n.p,{children:"Wird dieses Statement auf einer Datenbank mit 500 Datens\xe4tzen ausgef\xfchrt, werden alle Werte \xfcberpr\xfcft."}),"\n",(0,r.jsxs)(n.p,{children:["Mit einem ",(0,r.jsx)(n.code,{children:"EXPLAIN"})," kann man \xfcberpr\xfcfen, was bei der Abfrage passiert."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"explain select customer_id, customer_name from customers where customer_id='140385';\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",metastring:'title="OUTPUT"',children:"+----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+\n| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |\n+----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+\n|  1 | SIMPLE      | customers | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  500 |    10.00 | Using where |\n+----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"key"}),": Ist der ",(0,r.jsx)(n.code,{children:"key"})," auf ",(0,r.jsx)(n.code,{children:"NULL"}),", ist das immer schlecht da er keinen key zum suchen nutzt.",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.code,{children:"rows"}),": Dieses Attribut zeigt wie viele Datens\xe4tze gesucht werden."]}),"\n",(0,r.jsx)(n.h5,{id:"1112-l\xf6sung",children:"1.1.1.2 L\xf6sung"}),"\n",(0,r.jsx)(n.p,{children:"Index erstellen"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"Create index customer_id ON customers (customer_Id);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Abfrage per ",(0,r.jsx)(n.code,{children:"EXPLAIN"})," \xfcberpr\xfcfen"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"Explain select customer_id, customer_name from customers where customer_id='140385';\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",metastring:'title="OUTPUT"',children:"+----+-------------+-----------+------------+------+---------------+-------------+---------+-------+------+----------+-------+\n| id | select_type | table     | partitions | type | possible_keys | key         | key_len | ref   | rows | filtered | Extra |\n+----+-------------+-----------+------------+------+---------------+-------------+---------+-------+------+----------+-------+\n|  1 | SIMPLE      | customers | NULL       | ref  | customer_id   | customer_id | 13      | const |    1 |   100.00 | NULL  |\n+----+-------------+-----------+------------+------+---------------+-------------+---------+-------+------+----------+-------+\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Da jetzt ein ",(0,r.jsx)(n.code,{children:"key"})," existiert und dieser genutzt wird, wird nicht mehr ",(0,r.jsx)(n.code,{children:"NULL"})," angezeigt. Auch kann man sehen, dass bei ",(0,r.jsx)(n.code,{children:"rows"})," nur noch ein Datensatz gesucht wird, da er nach der ",(0,r.jsx)(n.code,{children:"customer_id"})," suchen kann."]}),"\n",(0,r.jsxs)(n.h4,{id:"112-unions-verwenden",children:["1.1.2 ",(0,r.jsx)(n.code,{children:"UNIONS"})," verwenden"]}),"\n",(0,r.jsxs)(n.p,{children:["Wenn bei einem ",(0,r.jsx)(n.code,{children:"WHERE"}),"-Statement mit ",(0,r.jsx)(n.code,{children:"OR"})," gearbeitet werden muss, sollte ein ",(0,r.jsx)(n.code,{children:"UNION"})," genutzt werden. Dieser kombiniert die Resultate von mehreren ",(0,r.jsx)(n.code,{children:"SELECTS"}),"."]}),"\n",(0,r.jsx)(n.h5,{id:"1121-problem",children:"1.1.2.1 Problem"}),"\n",(0,r.jsxs)(n.p,{children:["Wenn Abfragen mit ",(0,r.jsx)(n.code,{children:"OR"})," durchgef\xfchrt werden, wird immer ein Full-Table-Scan gemacht, auch wenn man einen Index nutzt. Mit ",(0,r.jsx)(n.code,{children:"UNION"})," kann dieses Problem gel\xf6st werden."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"select * from students where first_name like 'Ade%'  or last_name like 'Ade%' ;\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"first_name"})," und ",(0,r.jsx)(n.code,{children:"last_name"})," sind indexiert."]})}),"\n",(0,r.jsx)(n.h5,{id:"1122-l\xf6sung",children:"1.1.2.2 L\xf6sung"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"select * from students where first_name like 'Ade%' union all\nselect * from students where last_name like 'Ade%' ;\n"})}),"\n",(0,r.jsx)(n.h4,{id:"113-wildcards",children:"1.1.3 Wildcards"}),"\n",(0,r.jsxs)(n.p,{children:["Wildcards (",(0,r.jsx)(n.code,{children:"*"}),") sollten vermeidet werden... ganz einfach."]}),"\n",(0,r.jsx)(n.h5,{id:"1131-problem",children:"1.1.3.1 Problem"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"select * from students where first_name like '%Ade' ;\n"})}),"\n",(0,r.jsx)(n.h5,{id:"1132-l\xf6sung",children:"1.1.3.2 L\xf6sung"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"select last_name from students where first_name like '%Ade' ;\n"})}),"\n",(0,r.jsx)(n.h4,{id:"114-full-text-searches-nutzen",children:"1.1.4 Full-Text-Searches nutzen"}),"\n",(0,r.jsx)(n.p,{children:"Full-Text-Searches ist besser als Wildcard"}),"\n",(0,r.jsx)(n.h5,{id:"1141-problem",children:"1.1.4.1 Problem"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"select * from students where first_name like  '%Ade' ;\n"})}),"\n",(0,r.jsx)(n.h5,{id:"1142-l\xf6sung",children:"1.1.4.2 L\xf6sung"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"Alter table students ADD FULLTEXT (first_name, last_name);\nSelect * from students where match(first_name, last_name) AGAINST ('Ade');\nexplain Select * from students where match(first_name, last_name) AGAINST ('Ade');\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",metastring:'title="OUTPUT"',children:"+----+-------------+----------+------------+----------+---------------+------------+---------+-------+------+----------+-------------------------------+\n| id | select_type | table    | partitions | type     | possible_keys | key        | key_len | ref   | rows | filtered | Extra                         |\n+----+-------------+----------+------------+----------+---------------+------------+---------+-------+------+----------+-------------------------------+\n|  1 | SIMPLE      | students | NULL       | fulltext | first_name    | first_name | 0       | const |    1 |   100.00 | Using where; Ft_hints: sorted |\n+----+-------------+----------+------------+----------+---------------+------------+---------+-------+------+----------+-------------------------------+\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Der ",(0,r.jsx)(n.code,{children:"SELECT"})," sucht jetzt in ",(0,r.jsx)(n.code,{children:"first_name"})," und ",(0,r.jsx)(n.code,{children:"last_name"})," nach dem Suchbegriff ",(0,r.jsx)(n.code,{children:"Ade"}),". Dies kann auch im ",(0,r.jsx)(n.code,{children:"EXPLAIN"})," unter ",(0,r.jsx)(n.code,{children:"type"})," gesehen werden."]}),"\n",(0,r.jsx)(n.h4,{id:"115-datenbank-design",children:"1.1.5 Datenbank-Design"}),"\n",(0,r.jsx)(n.p,{children:"Grunds\xe4tzlich gilt:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Redunante Daten vermeiden"}),"\n",(0,r.jsxs)(n.li,{children:["Korrekte ",(0,r.jsx)(n.a,{href:"/docs/M141/tag-0004#213-datentypen--attribute",children:"Datentypen"})," verwenden"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"NULL"}),"-Werte vermeiden (",(0,r.jsx)(n.code,{children:"EXPLAIN"})," hilft hier)"]}),"\n",(0,r.jsx)(n.li,{children:"Viele Spalten in einer Tabellen vermeiden"}),"\n",(0,r.jsx)(n.li,{children:'SQL-Joins "klein" halten. Nur die notwendigen Tabellen einbeziehen.'}),"\n",(0,r.jsx)(n.li,{children:"Keine Wildcards"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"12-\xfcbungsdokumentation-zu-performance-und-indexing",children:"1.2 \xdcbungsdokumentation zu Performance und Indexing"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["DB installieren (",(0,r.jsx)(n.a,{href:"/appendix/M141/classicModelsOhneIndex",children:"Skript"}),")"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Es existieren noch keine Indexe auf der Datenbank. Mit ",(0,r.jsx)(n.code,{children:"EXPLAIN"})," kann das \xfcberpr\xfcft werden."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'EXPLAIN SELECT * FROM orderdetails d\n    INNER JOIN orders o ON d.orderNumber = o.orderNumber\n    INNER JOIN products p ON p.productCode = d.productCode\n    INNER JOIN productlines l ON p.productLine = l.productLine\n    INNER JOIN customers c on c.customerNumber = o.customerNumber\nWHERE o.orderNumber = "10101";\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",metastring:'title="OUTPUT"',children:"+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+--------------------------------------------+\n| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                                      |\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+--------------------------------------------+\n|  1 | SIMPLE      | l     | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    7 |   100.00 | NULL                                       |\n|  1 | SIMPLE      | p     | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  110 |    10.00 | Using where; Using join buffer (hash join) |\n|  1 | SIMPLE      | o     | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  326 |    10.00 | Using where; Using join buffer (hash join) |\n|  1 | SIMPLE      | c     | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  122 |    10.00 | Using where; Using join buffer (hash join) |\n|  1 | SIMPLE      | d     | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 2996 |     1.00 | Using where; Using join buffer (hash join) |\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+--------------------------------------------+\n5 rows in set, 1 warning (0.04 sec)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"type"}),": steht auf ",(0,r.jsx)(n.code,{children:"ALL"}),", somit wird die ganze Tabelle durchsucht (also kein Index oder Fulltext)",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.code,{children:"keys"})," und ",(0,r.jsx)(n.code,{children:"possible_key"}),": steht auf ",(0,r.jsx)(n.code,{children:"NULL"}),", da es keine Indexe gibt",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.code,{children:"rows"}),": Es werden 7 * 110 * 326 * 122 * 2'996 = 91'750'822'240 (91 Mrd.) Elemente gesucht"]}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"Primary Key Indexe einf\xfchren"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE customers ADD PRIMARY KEY (customerNumber);\nALTER TABLE employees ADD PRIMARY KEY (employeeNumber);\nALTER TABLE offices ADD PRIMARY KEY (officeCode);\nALTER TABLE orderdetails ADD PRIMARY KEY (orderNumber, productCode);\nALTER TABLE orders ADD PRIMARY KEY (orderNumber), ADD KEY (customerNumber);\nALTER TABLE payments ADD PRIMARY KEY (customerNumber, checkNumber);\nALTER TABLE productlines ADD PRIMARY KEY (productLine);\nALTER TABLE products ADD PRIMARY KEY (productCode), ADD KEY (buyPrice), ADD KEY (productLine);\nALTER TABLE productvariants ADD PRIMARY KEY (variantId), ADD KEY (buyPrice), ADD KEY (productCode);\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsxs)(n.li,{children:["Per ",(0,r.jsx)(n.code,{children:"EXPLAIN"})," die Abfrage wieder \xfcberpr\xfcfen"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'EXPLAIN SELECT * FROM orderdetails d\n    INNER JOIN orders o ON d.orderNumber = o.orderNumber\n    INNER JOIN products p ON p.productCode = d.productCode\n    INNER JOIN productlines l ON p.productLine = l.productLine\n    INNER JOIN customers c on c.customerNumber = o.customerNumber\nWHERE o.orderNumber = "10101";\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",metastring:'title="OUTPUT"',children:"+----+-------------+-------+------------+--------+------------------------+---------+---------+------------------------------+------+----------+-----------------------+\n| id | select_type | table | partitions | type   | possible_keys          | key     | key_len | ref                          | rows | filtered | Extra                 |\n+----+-------------+-------+------------+--------+------------------------+---------+---------+------------------------------+------+----------+-----------------------+\n|  1 | SIMPLE      | o     | NULL       | const  | PRIMARY,customerNumber | PRIMARY | 4       | const                        |    1 |   100.00 | NULL                  |\n|  1 | SIMPLE      | c     | NULL       | const  | PRIMARY                | PRIMARY | 4       | const                        |    1 |   100.00 | NULL                  |\n|  1 | SIMPLE      | d     | NULL       | ref    | PRIMARY                | PRIMARY | 4       | const                        |    4 |   100.00 | Using index condition |\n|  1 | SIMPLE      | p     | NULL       | eq_ref | PRIMARY,productLine    | PRIMARY | 17      | explaintesting.d.productCode |    1 |   100.00 | NULL                  |\n|  1 | SIMPLE      | l     | NULL       | eq_ref | PRIMARY                | PRIMARY | 52      | explaintesting.p.productLine |    1 |   100.00 | NULL                  |\n+----+-------------+-------+------------+--------+------------------------+---------+---------+------------------------------+------+----------+-----------------------+\n5 rows in set, 1 warning (0.00 sec)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Jetzt hat jede Tabelle einen definierten ",(0,r.jsx)(n.code,{children:"type"})," und nutzt immer einen ",(0,r.jsx)(n.code,{children:"key"}),". Die ",(0,r.jsx)(n.code,{children:"rows"})," k\xf6nnen jetzt nochmals nachgerechnet werden. 1 * 1 * 4 * 1 * 1 = 4. Nat\xfcrlich viel besser."]})]})}function u(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},11151:(e,n,s)=>{s.d(n,{Z:()=>l,a:()=>t});var r=s(67294);const i={},d=r.createContext(i);function t(e){const n=r.useContext(d);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);