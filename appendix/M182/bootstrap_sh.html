<!doctype html>
<html lang="de-CH" dir="ltr" class="docs-wrapper plugin-docs plugin-id-appendix docs-version-current docs-doc-page docs-doc-id-M182/bootstrap_sh" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">bootstrap.sh | Lernjournal</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://lernjournal.valentino-panico.ch/appendix/M182/bootstrap_sh"><meta data-rh="true" property="og:locale" content="de_CH"><meta data-rh="true" name="docusaurus_locale" content="de"><meta data-rh="true" name="docsearch:language" content="de"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-appendix-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-appendix-current"><meta data-rh="true" property="og:title" content="bootstrap.sh | Lernjournal"><link data-rh="true" rel="icon" href="/data/favicon.ico"><link data-rh="true" rel="canonical" href="https://lernjournal.valentino-panico.ch/appendix/M182/bootstrap_sh"><link data-rh="true" rel="alternate" href="https://lernjournal.valentino-panico.ch/appendix/M182/bootstrap_sh" hreflang="de-CH"><link data-rh="true" rel="alternate" href="https://lernjournal.valentino-panico.ch/appendix/M182/bootstrap_sh" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.9d53e01e.css">
<script src="/assets/js/runtime~main.3702e8f1.js" defer="defer"></script>
<script src="/assets/js/main.6ad82248.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Zum Hauptinhalt springen"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Zum Hauptinhalt springen</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/data/logo.png" alt="Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/data/logo.png" alt="Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Lernjournal</b></a><a class="navbar__item navbar__link" href="/docs">Doku ðŸ“–<!-- --></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/appendix">Appendix ðŸ“š<!-- --></a><a class="navbar__item navbar__link" href="/docs/tags">Tags ðŸ”Ž<!-- --></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ZZELAV/lernjournal" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><a href="https://moodle.bztf.ch/my/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-moodle-link"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Umschalten zwischen dunkler und heller Ansicht (momentan heller Modus)" aria-label="Umschalten zwischen dunkler und heller Ansicht (momentan heller Modus)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="ZurÃ¼ck nach oben scrollen" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/appendix">Appendix<!-- --></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/appendix/M126/lernjournal">M126</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/appendix/M141/glossar">M141</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/appendix/M143/art_9_vdsg">M143</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/appendix/M182/ELK_sh">M182</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/appendix/M182/ELK_sh">ELK.sh<!-- --></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/appendix/M182/apt_installed">apt list --installed<!-- --></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/appendix/M182/bootstrap_sh">bootstrap.sh<!-- --></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/appendix/M182/sysmon_config">Sysmon Config<!-- --></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/appendix/M226B/UML">M226B</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/appendix/M239/apache_config">M239</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">M182</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">bootstrap.sh</span><meta itemprop="position" content="2"></li></ul></nav><div class="theme-doc-markdown markdown"><h1>bootstrap.sh</h1>
<!-- --><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#! /bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Override existing DNS Settings using netplan, but don&#x27;t do it for Terraform builds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">169.254</span><span class="token plain">.169.254 --connect-timeout </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/dev/null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;    eth1:</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">      dhcp4: true</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">      nameservers:</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">        addresses: [8.8.8.8,8.8.4.4]&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain">/etc/netplan/01-netcfg.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  netplan apply</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;s/nameserver 127.0.0.53/nameserver 8.8.8.8/g&#x27;</span><span class="token plain"> /etc/resolv.conf </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> chattr +i /etc/resolv.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">DEBIAN_FRONTEND</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">noninteractive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;apt-fast apt-fast/maxdownloads string 10&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> debconf-set-selections</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;apt-fast apt-fast/dlflag boolean true&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> debconf-set-selections</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># sed -i &quot;2ideb mirror://mirrors.ubuntu.com/mirrors.txt bionic main restricted universe multiverse\ndeb mirror://mirrors.ubuntu.com/mirrors.txt bionic-updates main restricted universe multiverse\ndeb mirror://mirrors.ubuntu.com/mirrors.txt bionic-backports main restricted universe multiverse\ndeb mirror://mirrors.ubuntu.com/mirrors.txt bionic-security main restricted universe multiverse&quot; /etc/apt/sources.list</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">apt_install_prerequisites</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Adding apt repositories...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Add repository for apt-fast</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  add-apt-repository </span><span class="token parameter variable" style="color:#36acaa">-y</span><span class="token plain"> ppa:apt-fast/stable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Add repository for yq</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  add-apt-repository </span><span class="token parameter variable" style="color:#36acaa">-y</span><span class="token plain"> ppa:rmescandon/yq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Add repository for suricata</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  add-apt-repository </span><span class="token parameter variable" style="color:#36acaa">-y</span><span class="token plain"> ppa:oisf/suricata-stable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Install prerequisites and useful tools</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Running apt-get clean...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Running apt-get update...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qq</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qq</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-y</span><span class="token plain"> apt-fast</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Running apt-fast install...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apt-fast </span><span class="token parameter variable" style="color:#36acaa">-qq</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-y</span><span class="token plain"> jq whois build-essential </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">unzip</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">htop</span><span class="token plain"> yq mysql-server redis-server python-pip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">modify_motd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Updating the MOTD...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Force color terminal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;s/#force_color_prompt=yes/force_color_prompt=yes/g&#x27;</span><span class="token plain"> /root/.bashrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;s/#force_color_prompt=yes/force_color_prompt=yes/g&#x27;</span><span class="token plain"> /home/vagrant/.bashrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Remove some stock Ubuntu MOTD content</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-x</span><span class="token plain"> /etc/update-motd.d/10-help-text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Copy the DetectionLab MOTD</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> /vagrant/resources/logger/20-detectionlab /etc/update-motd.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x /etc/update-motd.d/20-detectionlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">test_prerequisites</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">package</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> jq whois build-essential </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">unzip</span><span class="token plain"> yq mysql-server redis-server python-pip</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: [TEST] Validating that </span><span class="token string variable" style="color:#36acaa">$package</span><span class="token string" style="color:#e3116c"> is correctly installed...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Loop through each package using dpkg</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> dpkg </span><span class="token parameter variable" style="color:#36acaa">-S</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$package</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/dev/null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># If which returns a non-zero return code, try to re-install the package</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[-] </span><span class="token string variable" style="color:#36acaa">$package</span><span class="token string" style="color:#e3116c"> was not found. Attempting to reinstall.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qq</span><span class="token plain"> update </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-y</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$package</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">which</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$package</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/dev/null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># If the reinstall fails, give up</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[X] Unable to install </span><span class="token string variable" style="color:#36acaa">$package</span><span class="token string" style="color:#e3116c"> even after a retry. Exiting.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[+] </span><span class="token string variable" style="color:#36acaa">$package</span><span class="token string" style="color:#e3116c"> was successfully installed!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">fix_eth1_static_ip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token assign-left variable" style="color:#36acaa">USING_KVM</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">sudo</span><span class="token variable" style="color:#36acaa"> lsmod </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> kvm</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-z</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$USING_KVM</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[*] Using KVM, no need to fix DHCP for eth1 iface&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># There&#x27;s a fun issue where dhclient keeps messing with eth1 despite the fact</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># that eth1 has a static IP set. We workaround this by setting a static DHCP lease.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;interface &quot;eth1&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    send host-name = gethostname();</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    send dhcp-requested-address 192.168.38.105;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  }&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain">/etc/dhcp/dhclient.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  netplan apply</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Fix eth1 if the IP isn&#x27;t set correctly</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token assign-left variable" style="color:#36acaa">ETH1_IP</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">ip</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-4</span><span class="token variable" style="color:#36acaa"> addr show eth1 </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-oP</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;(?&lt;=inet\s)\d+(\.\d+){3}&#x27;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$ETH1_IP</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;192.168.38.105&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Incorrect IP Address settings detected. Attempting to fix.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">ifdown</span><span class="token plain"> eth1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> addr flush dev eth1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">ifup</span><span class="token plain"> eth1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token assign-left variable" style="color:#36acaa">ETH1_IP</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">ifconfig</span><span class="token variable" style="color:#36acaa"> eth1 </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;inet addr&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">cut</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-d</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;:&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-f</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable number" style="color:#36acaa">2</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">cut</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-d</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27; &#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-f</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable number" style="color:#36acaa">1</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$ETH1_IP</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;192.168.38.105&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: The static IP has been fixed and set to 192.168.38.105&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Failed to fix the broken static IP for eth1. Exiting because this will cause problems with other VMs.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Make sure we do have a DNS resolution</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">dig</span><span class="token string variable" style="color:#36acaa"> +short @8.8.8.8 github.com</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"> </span><span class="token builtin class-name">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sleep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">download_palantir_osquery_config</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> /opt/osquery-configuration </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: osquery configs have already been downloaded&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Import Palantir osquery configs into Fleet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Downloading Palantir osquery configs...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">cd</span><span class="token plain"> /opt </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/palantir/osquery-configuration.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">install_fleet_import_osquery_config</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/opt/fleet&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Fleet is already installed&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">cd</span><span class="token plain"> /opt </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Installing Fleet...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">127.0.0.1       kolide&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain">/etc/hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">127.0.0.1       logger&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain">/etc/hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mysql </span><span class="token parameter variable" style="color:#36acaa">-uroot</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;kolide&#x27;;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mysql </span><span class="token parameter variable" style="color:#36acaa">-uroot</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-pkolide</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;create database kolide;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--progress</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">bar:force https://github.com/kolide/fleet/releases/download/3.0.0/fleet.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">unzip</span><span class="token plain"> fleet.zip </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> fleet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> fleet/linux/fleetctl /usr/local/bin/fleetctl </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x /usr/local/bin/fleetctl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> fleet/linux/fleet /usr/local/bin/fleet </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x /usr/local/bin/fleet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fleet prepare db </span><span class="token parameter variable" style="color:#36acaa">--mysql_address</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:3306 </span><span class="token parameter variable" style="color:#36acaa">--mysql_database</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kolide </span><span class="token parameter variable" style="color:#36acaa">--mysql_username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">root </span><span class="token parameter variable" style="color:#36acaa">--mysql_password</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kolide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> /vagrant/resources/fleet/server.* /opt/fleet/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> /vagrant/resources/fleet/fleet.service /etc/systemd/system/fleet.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /var/log/kolide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /bin/systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> fleet.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /bin/systemctl start fleet.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Waiting for fleet service...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># while true; do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#   result=$(curl --silent -k https://192.168.38.105:8412)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#   if echo $result | grep -q setup; then break; fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#   sleep 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fleetctl config </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--address</span><span class="token plain"> https://192.168.38.105:8412</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fleetctl config </span><span class="token builtin class-name">set</span><span class="token plain"> --tls-skip-verify </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fleetctl setup </span><span class="token parameter variable" style="color:#36acaa">--email</span><span class="token plain"> info@cyberdefenders.org </span><span class="token parameter variable" style="color:#36acaa">--username</span><span class="token plain"> vagrant </span><span class="token parameter variable" style="color:#36acaa">--password</span><span class="token plain"> vagrant --org-name DetectionLabELK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fleetctl login </span><span class="token parameter variable" style="color:#36acaa">--email</span><span class="token plain"> info@cyberdefenders.org </span><span class="token parameter variable" style="color:#36acaa">--password</span><span class="token plain"> vagrant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Set the enrollment secret to match what we deploy to Windows hosts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mysql </span><span class="token parameter variable" style="color:#36acaa">-uroot</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--password</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kolide </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;use kolide; update enroll_secrets set secret = &quot;enrollmentsecret&quot; where active=1;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Updated enrollment secret&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Change the query invervals to reflect a lab environment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Every hour -&gt; Every 3 minutes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Every 24 hours -&gt; Every 15 minutes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;s/interval: 3600/interval: 180/g&#x27;</span><span class="token plain"> osquery-configuration/Fleet/Endpoints/MacOS/osquery.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;s/interval: 3600/interval: 180/g&#x27;</span><span class="token plain"> osquery-configuration/Fleet/Endpoints/Windows/osquery.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;s/interval: 28800/interval: 900/g&#x27;</span><span class="token plain"> osquery-configuration/Fleet/Endpoints/MacOS/osquery.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;s/interval: 28800/interval: 900/g&#x27;</span><span class="token plain"> osquery-configuration/Fleet/Endpoints/Windows/osquery.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Don&#x27;t log osquery INFO messages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Fix snapshot event formatting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fleetctl get options </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/tmp/options.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /usr/bin/yq w </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> /tmp/options.yaml </span><span class="token string" style="color:#e3116c">&#x27;spec.config.options.logger_snapshot_event_type&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;true&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;s/kind: option/kind: options/g&#x27;</span><span class="token plain"> /tmp/options.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fleetctl apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> /tmp/options.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Use fleetctl to import YAML files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fleetctl apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> osquery-configuration/Fleet/Endpoints/MacOS/osquery.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fleetctl apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> osquery-configuration/Fleet/Endpoints/Windows/osquery.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">pack</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> osquery-configuration/Fleet/Endpoints/packs/*.yaml</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      fleetctl apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$pack</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">install_zeek</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Installing Zeek...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Environment variables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token assign-left variable" style="color:#36acaa">NODECFG</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/opt/zeek/etc/node.cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> /opt/zeek/etc/node.cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> /opt/zeek/share/zeek/site/local.zeek</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># SPLUNK_ZEEK_JSON=/opt/splunk/etc/apps/Splunk_TA_bro</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># SPLUNK_ZEEK_MONITOR=&#x27;monitor:///opt/zeek/spool/manager&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># SPLUNK_SURICATA_MONITOR=&#x27;monitor:///var/log/suricata&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># SPLUNK_SURICATA_SOURCETYPE=&#x27;json_suricata&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;echo &#x27;deb http://download.opensuse.org/repositories/security:/zeek/xUbuntu_18.04/ /&#x27; &gt; /etc/apt/sources.list.d/security:zeek.list&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-nv</span><span class="token plain"> https://download.opensuse.org/repositories/security:zeek/xUbuntu_18.04/Release.key </span><span class="token parameter variable" style="color:#36acaa">-O</span><span class="token plain"> /tmp/Release.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apt-key </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> - </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">/tmp/Release.key </span><span class="token operator" style="color:#393A34">&amp;&gt;</span><span class="token plain">/dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Update APT repositories</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qq</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-ym</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Install tools to build and configure Zeek</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-qq</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-ym</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> zeek crudini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:#36acaa">PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token environment constant" style="color:#36acaa">$PATH</span><span class="token plain">:/opt/zeek/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">zkg</span><span class="token operator" style="color:#393A34">==</span><span class="token number" style="color:#36acaa">2.1</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  zkg refresh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  zkg autoconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  zkg </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--force</span><span class="token plain"> salesforce/ja3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Load Zeek scripts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  @load protocols/ftp/software</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  @load protocols/smtp/software</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  @load protocols/ssh/software</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  @load protocols/http/software</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  @load tuning/json-logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  @load policy/integration/collective-intel</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  @load policy/frameworks/intel/do_notice</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  @load frameworks/intel/seen</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  @load frameworks/intel/do_notice</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  @load frameworks/files/hash-all-files</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  @load base/protocols/smb</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  @load policy/protocols/conn/vlan-logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  @load policy/protocols/conn/mac-logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  @load ja3</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  redef Intel::read_files += {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;/opt/zeek/etc/intel.dat&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  };</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain">/opt/zeek/share/zeek/site/local.zeek</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Configure Zeek</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crudini </span><span class="token parameter variable" style="color:#36acaa">--del</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$NODECFG</span><span class="token plain"> zeek</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crudini </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$NODECFG</span><span class="token plain"> manager </span><span class="token builtin class-name">type</span><span class="token plain"> manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crudini </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$NODECFG</span><span class="token plain"> manager </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crudini </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$NODECFG</span><span class="token plain"> proxy </span><span class="token builtin class-name">type</span><span class="token plain"> proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crudini </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$NODECFG</span><span class="token plain"> proxy </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Setup $CPUS numbers of Zeek workers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crudini </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$NODECFG</span><span class="token plain"> worker-eth1 </span><span class="token builtin class-name">type</span><span class="token plain"> worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crudini </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$NODECFG</span><span class="token plain"> worker-eth1 </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crudini </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$NODECFG</span><span class="token plain"> worker-eth1 interface eth1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crudini </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$NODECFG</span><span class="token plain"> worker-eth1 lb_method pf_ring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crudini </span><span class="token parameter variable" style="color:#36acaa">--set</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$NODECFG</span><span class="token plain"> worker-eth1 lb_procs </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">nproc</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Setup Zeek to run at boot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> /vagrant/resources/zeek/zeek.service /lib/systemd/system/zeek.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> zeek</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  systemctl start zeek</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Verify that Zeek is running</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># if ! pgrep -f zeek &gt;/dev/null; then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#   echo &quot;Zeek attempted to start but is not running. Exiting&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#   exit 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">install_velociraptor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Installing Velociraptor...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/opt/velociraptor&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /opt/velociraptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Attempting to determine the URL for the latest release of Velociraptor&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token assign-left variable" style="color:#36acaa">LATEST_VELOCIRAPTOR_LINUX_URL</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">curl</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-sL</span><span class="token variable" style="color:#36acaa"> https://github.com/Velocidex/velociraptor/releases/latest </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> linux-amd64 </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> href </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">head</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-1</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">cut</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-d</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;&quot;&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-f</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable number" style="color:#36acaa">2</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">sed</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;s#^#https://github.com#g&#x27;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: The URL for the latest release was extracted as </span><span class="token string variable" style="color:#36acaa">$LATEST_VELOCIRAPTOR_LINUX_URL</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Attempting to download...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-P</span><span class="token plain"> /opt/velociraptor </span><span class="token parameter variable" style="color:#36acaa">--progress</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">bar:force </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$LATEST_VELOCIRAPTOR_LINUX_URL</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">file</span><span class="token string variable" style="color:#36acaa"> /opt/velociraptor/velociraptor*linux-amd64 </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">grep</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-c</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&#x27;ELF 64-bit LSB executable&#x27;</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-eq</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Velociraptor successfully downloaded!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Failed to download the latest version of Velociraptor. Please open a DetectionLab issue on Github.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">cd</span><span class="token plain"> /opt/velociraptor </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> velociraptor-*-linux-amd64 velociraptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x velociraptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> /vagrant/resources/velociraptor/server.config.yaml /opt/velociraptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Creating Velociraptor dpkg...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ./velociraptor </span><span class="token parameter variable" style="color:#36acaa">--config</span><span class="token plain"> /opt/velociraptor/server.config.yaml debian server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Installing the dpkg...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> dpkg </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> velociraptor_*_server.deb </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/dev/null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Installation complete!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Failed to install the dpkg&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">date</span><span class="token string variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">]: Creating admin user...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-u</span><span class="token plain"> velociraptor ./velociraptor </span><span class="token parameter variable" style="color:#36acaa">--config</span><span class="token plain"> /opt/velociraptor/server.config.yaml user </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--role</span><span class="token plain"> administrator vagrant vagrant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-rf</span><span class="token plain"> /opt/velociraptor/users/admin.db /opt/velociraptor/acl/admin.json.db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">install_suricata</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Run iwr -Uri testmyids.com -UserAgent &quot;BlackSun</span><span class="token string" style="color:#e3116c">&quot; in Powershell to generate test alerts from Windows</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  echo &quot;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">date</span><span class="token variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token variable" style="color:#36acaa">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: Installing Suricata</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # Install suricata</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  apt-get -qq -y install suricata crudini</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  test_suricata_prerequisites</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # Install suricata-update</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  cd /opt || exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  git clone https://github.com/OISF/suricata-update.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  cd /opt/suricata-update || exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  pip install pyyaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  python setup.py install</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  cp /vagrant/resources/suricata/suricata.yaml /etc/suricata/suricata.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  crudini --set --format=sh /etc/default/suricata &#x27;&#x27; iface eth1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # update suricata signature sources</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  suricata-update update-sources</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # disable protocol decode as it is duplicative of Zeek</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  echo re:protocol-command-decode &gt;&gt;/etc/suricata/disable.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # enable et-open and attackdetection sources</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  suricata-update enable-source et/open</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  suricata-update enable-source ptresearch/attackdetection</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # Update suricata and restart</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  suricata-update</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  service suricata stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  service suricata start</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  sleep 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # Verify that Suricata is running</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  if ! pgrep -f suricata &gt;/dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    echo &quot;</span><span class="token plain">Suricata attempted to start but is not running. Exiting</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  cat &gt;/etc/logrotate.d/suricata &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">/var/log/suricata/*.log /var/log/suricata/*.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    hourly</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    rotate 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    missingok</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    nocompress</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    size=500M</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    sharedscripts</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    postrotate</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">            /bin/kill -HUP \</span><span class="token string variable" style="color:#36acaa">`</span><span class="token string variable function" style="color:#d73a49">cat</span><span class="token string variable" style="color:#36acaa"> /var/run/suricata.pid </span><span class="token string variable operator file-descriptor important" style="color:#393A34">2</span><span class="token string variable operator" style="color:#393A34">&gt;</span><span class="token string variable" style="color:#36acaa">/dev/null</span><span class="token string variable punctuation" style="color:#393A34">\</span><span class="token string variable" style="color:#36acaa">`</span><span class="token string" style="color:#e3116c"> 2&gt;/dev/null || true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    endscript</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">test_suricata_prerequisites() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  for package in suricata crudini; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    echo &quot;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">date</span><span class="token variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token variable" style="color:#36acaa">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">TEST</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Validating that </span><span class="token variable" style="color:#36acaa">$package</span><span class="token plain"> is correctly installed</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    # Loop through each package using dpkg</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    if ! dpkg -S </span><span class="token string variable" style="color:#36acaa">$package</span><span class="token string" style="color:#e3116c"> &gt;/dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      # If which returns a non-zero return code, try to re-install the package</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      echo &quot;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$package</span><span class="token plain"> was not found. Attempting to reinstall.</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      apt-get clean &amp;&amp; apt-get -qq update &amp;&amp; apt-get install -y </span><span class="token string variable" style="color:#36acaa">$package</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      if ! which </span><span class="token string variable" style="color:#36acaa">$package</span><span class="token string" style="color:#e3116c"> &gt;/dev/null; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        # If the reinstall fails, give up</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        echo &quot;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">X</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Unable to </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$package</span><span class="token plain"> even after a retry. Exiting.</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">        exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      echo &quot;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$package</span><span class="token plain"> was successfully installed</span><span class="token operator" style="color:#393A34">!</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  done</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">install_guacamole() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  echo &quot;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">date</span><span class="token variable" style="color:#36acaa"> +%H:%M:%S</span><span class="token variable" style="color:#36acaa">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: Installing Guacamole</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  cd /opt || exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  apt-get -qq install -y libcairo2-dev libjpeg62-dev libpng-dev libossp-uuid-dev libfreerdp-dev libpango1.0-dev libssh2-1-dev libssh-dev tomcat8 tomcat8-admin tomcat8-user</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  wget --progress=bar:force &quot;</span><span class="token plain">http://apache.org/dyn/closer.cgi?action</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">download</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">filename</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">guacamole/1.0.0/source/guacamole-server-1.0.0.tar.gz</span><span class="token string" style="color:#e3116c">&quot; -O guacamole-server-1.0.0.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  tar -xf guacamole-server-1.0.0.tar.gz &amp;&amp; cd guacamole-server-1.0.0 || echo &quot;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Unable to </span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> the Guacamole folder.</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  ./configure &amp;&gt;/dev/null &amp;&amp; make --quiet &amp;&gt;/dev/null &amp;&amp; make --quiet install &amp;&gt;/dev/null || echo &quot;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> An error occurred </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> installing Guacamole.</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  ldconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  cd /var/lib/tomcat8/webapps || echo &quot;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Unable to </span><span class="token function" style="color:#d73a49">find</span><span class="token plain"> the tomcat8/webapps folder.</span><span class="token string" style="color:#e3116c">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  wget --progress=bar:force &quot;</span><span class="token plain">http://apache.org/dyn/closer.cgi?action</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">download</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token assign-left variable" style="color:#36acaa">filename</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">guacamole/1.0.0/binary/guacamole-1.0.0.war</span><span class="token string" style="color:#e3116c">&quot; -O guacamole.war</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  mkdir /etc/guacamole</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  mkdir /usr/share/tomcat8/.guacamole</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  cp /vagrant/resources/guacamole/user-mapping.xml /etc/guacamole/</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  cp /vagrant/resources/guacamole/guacamole.properties /etc/guacamole/</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  cp /vagrant/resources/guacamole/guacd.service /lib/systemd/system</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  sudo ln -s /etc/guacamole/guacamole.properties /usr/share/tomcat8/.guacamole/</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  sudo ln -s /etc/guacamole/user-mapping.xml /usr/share/tomcat8/.guacamole/</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  chown tomcat8 /etc/guacamole/user-mapping.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  systemctl enable guacd</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  systemctl enable tomcat8</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  systemctl start guacd</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  systemctl start tomcat8</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">postinstall_tasks() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # Include Splunk and Zeek in the PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  echo export PATH=&quot;</span><span class="token environment constant" style="color:#36acaa">$PATH</span><span class="token plain">:/opt/zeek/bin</span><span class="token string" style="color:#e3116c">&quot; &gt;&gt;~/.bashrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # Ping DetectionLab server for usage statistics</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  # curl -A &quot;</span><span class="token plain">DetectionLab-logger</span><span class="token string" style="color:#e3116c">&quot; &quot;</span><span class="token plain">https://cyberdefenders.org/logger&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apt_install_prerequisites</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  modify_motd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  test_prerequisites</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#fix_eth1_static_ip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  download_palantir_osquery_config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  install_fleet_import_osquery_config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  install_velociraptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  install_suricata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  install_zeek</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  install_guacamole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  postinstall_tasks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="In die Zwischenablage kopieren" title="Kopieren" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Dokumentation Seiten"><a class="pagination-nav__link pagination-nav__link--prev" href="/appendix/M182/apt_installed"><div class="pagination-nav__sublabel">ZurÃ¼ck<!-- --></div><div class="pagination-nav__label">apt list --installed</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/appendix/M182/sysmon_config"><div class="pagination-nav__sublabel">Weiter<!-- --></div><div class="pagination-nav__label">Sysmon Config</div></a></nav></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">// Aktuelle Module</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/M145">M145<!-- --></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/M182">M182<!-- --></a></li></ul></div><div class="col footer__col"><div class="footer__title">// Links</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Home<!-- --></a></li><li class="footer__item"><a class="footer__link-item" href="/docs">Doku<!-- --></a></li><li class="footer__item"><a class="footer__link-item" href="/appendix">Appendix<!-- --></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tags">Tags<!-- --></a></li></ul></div><div class="col footer__col"><div class="footer__title"> </div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/ZZELAV/lernjournal" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<!-- --><svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://moodle.bztf.ch/my/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Moodle<!-- --><svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.markdownguide.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Markdown Guide<!-- --><svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus<!-- --><svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2024 Lernjournal, Valentino Panico. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>